import{g as E,e as y,a as x,p as T}from"./openrouter.js";const m={name:"ChatGPT",inputSelectors:["#prompt-textarea",'textarea[data-id="root"]','div[contenteditable="true"]',"textarea"],getInputElement:()=>{for(const e of m.inputSelectors){const t=document.querySelector(e);if(t)return t}return null},getInputValue:e=>e instanceof HTMLTextAreaElement?e.value:e.textContent||e.innerText||"",setInputValue:(e,t)=>{e instanceof HTMLTextAreaElement?(e.value=t,e.dispatchEvent(new Event("input",{bubbles:!0}))):(e.textContent=t,e.dispatchEvent(new InputEvent("input",{bubbles:!0,data:t}))),e.dispatchEvent(new Event("change",{bubbles:!0}))},getButtonContainer:e=>e.closest("form")||e.parentElement},f={name:"Gemini",inputSelectors:[".ql-editor",'[contenteditable="true"]',"rich-textarea .textarea","div[data-placeholder]"],getInputElement:()=>{for(const e of f.inputSelectors){const t=document.querySelector(e);if(t&&t.getAttribute("contenteditable")==="true")return t}return document.querySelector('[contenteditable="true"]')},getInputValue:e=>e.textContent||e.innerText||"",setInputValue:(e,t)=>{e.innerHTML="";const n=document.createElement("p");n.textContent=t,e.appendChild(n),e.dispatchEvent(new InputEvent("input",{bubbles:!0}))},getButtonContainer:e=>{var t;return e.closest(".input-area")||((t=e.parentElement)==null?void 0:t.parentElement)||e.parentElement}},g={name:"Claude",inputSelectors:['div[contenteditable="true"]',".ProseMirror","textarea"],getInputElement:()=>{for(const e of g.inputSelectors){const t=document.querySelector(e);if(t)return t}return null},getInputValue:e=>e instanceof HTMLTextAreaElement?e.value:e.textContent||e.innerText||"",setInputValue:(e,t)=>{e instanceof HTMLTextAreaElement?(e.value=t,e.dispatchEvent(new Event("input",{bubbles:!0}))):(e.innerHTML=`<p>${t}</p>`,e.dispatchEvent(new InputEvent("input",{bubbles:!0})))},getButtonContainer:e=>{var t;return e.closest("fieldset")||((t=e.parentElement)==null?void 0:t.parentElement)||e.parentElement}};function w(){const e=window.location.hostname;return e.includes("chat.openai.com")||e.includes("chatgpt.com")?m:e.includes("gemini.google.com")?f:e.includes("claude.ai")?g:null}function C(e,t=1e4){return new Promise(n=>{for(const r of e){const i=document.querySelector(r);if(i){n(i);return}}const o=new MutationObserver(()=>{for(const r of e){const i=document.querySelector(r);if(i){o.disconnect(),n(i);return}}});o.observe(document.body,{childList:!0,subtree:!0}),setTimeout(()=>{o.disconnect(),n(null)},t)})}async function I(e){try{if(!e||e.trim().length===0)return{success:!1,error:"Please enter a prompt to enhance"};const t=await E();if(t.provider==="gemini"&&!t.geminiApiKey)return{success:!1,error:"Please configure your Gemini API key in the extension settings"};if(t.provider==="openrouter"&&!t.openrouterApiKey)return{success:!1,error:"Please configure your OpenRouter API key in the extension settings"};let n="";return t.provider==="gemini"?n=await y(t.geminiApiKey,e,t.geminiModel):n=await x(t.openrouterApiKey,e,t.openrouterModel),{success:!0,enhancedPrompt:T(n).enhancedPrompt}}catch(t){return console.error("[RePRo] Enhancement error:",t),{success:!1,error:t instanceof Error?t.message:"Enhancement failed. Please try again."}}}const h="repro-enhance-btn",b="repro-enhance-container",v="repro-toast";let u=null;const P=500;function R(){const e=document.createElement("button");return e.id=h,e.className="repro-enhance-btn",e.innerHTML=`
        <span class="repro-btn-icon">⚡</span>
        <span class="repro-btn-text">Improve</span>
    `,e.title="Enhance this prompt with AI",e}function S(){const e=document.createElement("div");return e.id=b,e.className="repro-enhance-container",e}function L(){const e=document.createElement("div");return e.id=v,e.className="repro-toast",e}function l(e,t="error"){let n=document.getElementById(v);n||(n=L(),document.body.appendChild(n)),n.textContent=e,n.className=`repro-toast repro-toast-${t} repro-toast-visible`,setTimeout(()=>{n==null||n.classList.remove("repro-toast-visible")},4e3)}function s(e,t){e.classList.remove("repro-btn-loading","repro-btn-success","repro-btn-error"),e.disabled=t==="loading";const n=e.querySelector(".repro-btn-icon"),o=e.querySelector(".repro-btn-text");switch(t){case"loading":e.classList.add("repro-btn-loading"),n&&(n.innerHTML='<span class="repro-spinner"></span>'),o&&(o.textContent="Improving...");break;case"success":e.classList.add("repro-btn-success"),n&&(n.textContent="✓"),o&&(o.textContent="Improved!"),setTimeout(()=>s(e,"idle"),2e3);break;case"error":e.classList.add("repro-btn-error"),n&&(n.textContent="✕"),o&&(o.textContent="Failed"),setTimeout(()=>s(e,"idle"),2e3);break;default:n&&(n.textContent="⚡"),o&&(o.textContent="Improve")}}async function B(e,t,n){if(u)return;u=window.setTimeout(()=>{u=null},P);const o=n.getInputValue(t);if(!o||o.trim().length===0){l("Please enter a prompt to improve","error");return}s(e,"loading");try{const r=await I(o);r.success&&r.enhancedPrompt?(n.setInputValue(t,r.enhancedPrompt),s(e,"success"),t.focus()):(s(e,"error"),l(r.error||"Enhancement failed","error"))}catch(r){s(e,"error"),l(r instanceof Error?r.message:"Enhancement failed. Please try again.","error"),console.error("[RePRo] Enhancement error:",r)}}function d(e,t){var i;const n=t.getBoundingClientRect(),o=t.closest("form")||((i=t.parentElement)==null?void 0:i.parentElement)||document.body;window.getComputedStyle(o).position==="static"&&(o.style.position="relative"),o&&o!==document.body?o.contains(e)||o.insertBefore(e,t.parentElement||t):(e.style.position="fixed",e.style.top=`${n.top-48}px`,e.style.left=`${n.left}px`,document.body.contains(e)||document.body.appendChild(e))}function A(e,t){if(document.getElementById(h))return;const n=S(),o=R();n.appendChild(o),d(n,e),o.addEventListener("click",r=>{r.preventDefault(),r.stopPropagation(),B(o,e,t)}),window.addEventListener("resize",()=>{d(n,e)}),console.log(`[RePRo] Improve button initialized for ${t.name}`)}function p(){const e=document.getElementById(b);e&&e.remove()}const a=w();a?(console.log(`[RePRo] Detected ${a.name}, initializing...`),c(),M()):console.log("[RePRo] Site not supported");async function c(){if(!a)return;const e=await C(a.inputSelectors);e?A(e,a):(console.log("[RePRo] Could not find input element, will retry..."),setTimeout(c,2e3))}function M(){let e=window.location.href;new MutationObserver(()=>{window.location.href!==e&&(e=window.location.href,console.log("[RePRo] Navigation detected, reinitializing..."),p(),setTimeout(c,1e3))}).observe(document.body,{childList:!0,subtree:!0}),window.addEventListener("popstate",()=>{console.log("[RePRo] Popstate navigation detected"),p(),setTimeout(c,1e3)})}
